!function(){var c,t;c=function(t){return t.name+"@"+(t.version||"")+":"+(t.path||"")},(t=function(t){return this.mgr=(t=null==t?{}:t).manager,this.store=window.localStorage,this._apiRoot=t.api||"/api/consent",this.global={user:(t.global||{}).user},this.userkey=((t=this.global).user||(t.user={})).key||0,this._apiRoot=this._apiRoot.replace(/\/$/,""),this}).prototype=function(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}(Object.create(Object.prototype),{_keep:function(t,e){var n;if(null==e&&(e=!0),t="module/consent/"+this.userkey+"/"+c(t),this.store.setItem(t,JSON.stringify({time:Date.now(),user:((n=this.global).user||(n.user={})).key||0})),e)return ld$.fetch(this._apiRoot+"",{method:"POST"},{json:{consent_id:t}})},prompt:function(e){for(var n,r=this,t=[],o=1,i=arguments.length;o<i;++o)t.push(arguments[o]);return n=t,this.mgr.get(e).then(function(t){return t.create()}).then(function(t){return t.attach({root:document.body}).then(function(){return t.interface()})}).then(function(t){return t.get.apply(t,n)}).then(function(t){return t?r._keep(e):Promise.reject(lderror(1018))})},ensure:function(e){for(var t,n,r,o=this,i=[],s=1,u=arguments.length;s<u;++s)i.push(arguments[s]);if(t=i,n="module/consent/"+this.userkey+"/"+c(e),r=this.store.getItem(n))try{return JSON.parse(r),Promise.resolve(!0)}catch(t){0}return ld$.fetch(this._apiRoot+"",{method:"POST"},{json:{consent_id:n,check:!0},type:"json"}).then(function(t){return t?(o._keep(e,!1),!0):lderror.reject(1018)}).catch(function(){return o.prompt.apply(o,[e].concat(t))})}}),"undefined"!=typeof module&&null!==module?module.exports=t:window.consent=t}.call(this);
