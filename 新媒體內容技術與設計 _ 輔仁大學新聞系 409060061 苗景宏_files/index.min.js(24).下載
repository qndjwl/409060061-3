ldc.register(["core"],function(n){var i=n.core;return i.init().then(function(){var u=this,r=i.auth;i.user;if(this.view={},this.user=i.user,this.global=i.global,i.manager.registry(function(n){var e=n.name,t=n.version,r=n.path,n=n.type,i="?dec="+(u.global.version||"");return"block"===n?/^@xinmeti/.exec(e)?"/block/"+(e=e.replace(/^@xinmeti/,""))+"/"+(t||"main")+"/"+(r||"index.html")+i:"/assets/lib/"+e+"/"+(t||"main")+"/"+(r||"index.html")+i:n?"/assets/lib/"+e+"/"+(t||"main")+"/"+(r||"index.min."+n)+i:"/assets/lib/"+e+"/"+(t||"main")+"/"+(r||"index.min.js")+i}),r.setUi({authpanel:function(e,t){return null==t&&(t={}),u._authpanel?u._authpanel(e,t):i.manager.from({name:"@xinmeti/auth"},{root:document.body,data:{auth:r}}).then(function(n){return u._authpanel=n.interface}).then(function(n){return n(e,t)})}}),this.update=function(n){return(n?Promise.resolve(n):r.get()).then(function(n){if(u.global=n,u.user=n.user||{},u.view.panel)return u.view.panel.render()})},r.on("change",function(n){return u.update(n)}),ld$.find("[ld-scope=nav-top]",0))return this.view.panel=new ldview({root:ld$.find("[ld-scope=nav-top]",0),action:{click:{signup:function(){return r.prompt({tab:"signup"}).then(function(){return u.update()})},login:function(){return r.prompt({tab:"login"}).then(function(){return u.update()})},logout:function(){return r.logout().then(function(){return u.update()})}}},text:{displayname:function(){return u.user.displayname||"User"}},handler:{admin:function(n){return n.node.classList.toggle("d-none",!u.user.staff)},unauthed:function(n){return n.node.classList.toggle("d-none",!!u.user.key)},authed:function(n){return n.node.classList.toggle("d-none",!u.user.key)},avatar:function(n){n=n.node.style;return n.backgroundImage="url(/assets/img/avatar.svg)",n.backgroundSize="cover",n}}})})});